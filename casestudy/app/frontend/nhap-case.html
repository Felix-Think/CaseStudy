<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nhập Case</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body class="app-body">
  <div class="app-bg"></div>

  <div class="app-shell">
    <header class="app-header">
      <div class="app-header__inner">
        <div class="brand">
          <div class="brand__icon">TAT</div>
          <div class="brand__text">
            <span class="brand__label">CaseStudy</span>
            <h1 class="brand__title">Nhập Case</h1>
          </div>
        </div>
        <nav class="header-actions">
          <a class="btn btn--ghost action-desktop" href="/">Trang chính</a>
          <a class="btn btn--ghost action-desktop" href="/chatframe">Chat Frame</a>
          <span class="pill">JSON Builder</span>
        </nav>
      </div>
    </header>

    <main class="app-main">
      <div class="form-page">
        <header class="form-header">
          <span class="pill">Chuẩn bị dữ liệu</span>
          <h2 class="form-title">Tạo và cập nhật CaseStudy Skeleton</h2>
          <p class="form-subtitle">
            Sử dụng các tab bên dưới để nhập Skeleton, Context và Personas. Các biểu mẫu này giúp bạn chuẩn bị
            JSON trước khi gửi tới hệ thống hoặc chia sẻ cho mentor.
          </p>
          <p class="form-note">Nội dung chỉ lưu trên trình duyệt cho tới khi bạn tự tải xuống hoặc sao chép.</p>
        </header>

        <div class="tab-bar" role="tablist" aria-label="Chế độ nhập case">
          <button type="button" role="tab" id="tab-skeleton" data-tab="skeleton" aria-controls="panel-skeleton" aria-selected="true" class="tab-btn is-active">Skeleton</button>
          <button type="button" role="tab" id="tab-context" data-tab="context" aria-controls="panel-context" aria-selected="false" class="tab-btn">Context</button>
          <button type="button" role="tab" id="tab-personas" data-tab="personas" aria-controls="panel-personas" aria-selected="false" class="tab-btn">Personas</button>
        </div>

        <section id="panel-skeleton" role="tabpanel" aria-labelledby="tab-skeleton" data-panel="skeleton" class="tab-panel is-active">
          <form class="form-section" data-prevent-submit>
            <div class="field-grid" data-cols="2">
              <div class="field">
                <label class="field-label" for="skeleton-case-id">Case ID</label>
                <input id="skeleton-case-id" type="text" class="input" placeholder="ví dụ: case_training_001" />
              </div>
              <div class="field">
                <label class="field-label" for="skeleton-case-name">Tên case</label>
                <input id="skeleton-case-name" type="text" class="input" placeholder="ví dụ: Huấn luyện xử lý sự cố" />
              </div>
            </div>

            <div class="field">
              <label class="field-label" for="skeleton-summary">Tổng quan</label>
              <textarea id="skeleton-summary" class="textarea" rows="3" placeholder="Mô tả ngắn về mục tiêu case và phạm vi đào tạo."></textarea>
            </div>

            <div class="block-list" data-skeleton-events>
              <div class="block-card" data-event-block>
                <div class="block-head">
                  <h3 class="block-title">Canon Event</h3>
                  <button type="button" data-remove-event class="link-action">Xóa</button>
                </div>
                <div class="field-grid" data-cols="2">
                  <div class="field">
                    <label class="field-label">Mã sự kiện</label>
                    <input type="text" class="input" placeholder="ví dụ: CE1" />
                  </div>
                  <div class="field">
                    <label class="field-label">Tiêu đề</label>
                    <input type="text" class="input" placeholder="ví dụ: Đánh giá hiện trường" />
                  </div>
                </div>
                <div class="field">
                  <label class="field-label">Mô tả chi tiết</label>
                  <textarea class="textarea" rows="3" placeholder="Mô tả nhiệm vụ chính của event."></textarea>
                </div>
                <div class="field-grid" data-cols="2">
                  <div class="field">
                    <label class="field-label">Success criteria</label>
                    <textarea class="textarea" rows="3" placeholder="Ghi từng tiêu chí trên một dòng."></textarea>
                  </div>
                  <div class="field">
                    <label class="field-label">NPC tham gia</label>
                    <input type="text" class="input" placeholder="ví dụ: P1 - Điều phối viên" />
                  </div>
                </div>
                <div class="field-grid" data-cols="3">
                  <div class="field">
                    <label class="field-label">Timeout</label>
                    <input type="number" min="0" class="input" placeholder="ví dụ: 3" />
                  </div>
                  <div class="field">
                    <label class="field-label">On Success</label>
                    <input type="text" class="input" placeholder="ví dụ: CE2" />
                  </div>
                  <div class="field">
                    <label class="field-label">On Fail</label>
                    <input type="text" class="input" placeholder="ví dụ: CE1_RETRY" />
                  </div>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button type="button" data-add-event class="btn btn--ghost">+ Thêm event</button>
            </div>

            <div class="form-actions">
              <button type="reset" class="btn btn--ghost">Reset</button>
              <button type="submit" class="btn btn--primary">Lưu Skeleton</button>
            </div>
          </form>
        </section>

        <section id="panel-context" role="tabpanel" aria-labelledby="tab-context" data-panel="context" class="tab-panel">
          <form class="form-section" data-prevent-submit>
            <div class="field-grid" data-cols="2">
              <div class="field">
                <label class="field-label">Case ID</label>
                <input type="text" class="input" placeholder="ví dụ: case_training_001" />
              </div>
              <div class="field">
                <label class="field-label">Chủ đề case</label>
                <input type="text" class="input" placeholder="ví dụ: Ứng phó sự cố" />
              </div>
            </div>

            <fieldset class="block-card">
              <div class="block-head">
                <h3 class="block-title">Thông tin hiện trường</h3>
              </div>
              <div class="field-grid" data-cols="2">
                <div class="field">
                  <label class="field-label">Thời gian</label>
                  <input type="text" class="input" placeholder="ví dụ: 14:30" />
                </div>
                <div class="field">
                  <label class="field-label">Thời tiết</label>
                  <input type="text" class="input" placeholder="ví dụ: Mưa nhẹ" />
                </div>
              </div>
              <div class="field">
                <label class="field-label">Vị trí</label>
                <textarea class="textarea" rows="2" placeholder="Mô tả vị trí cụ thể của hiện trường."></textarea>
              </div>
              <div class="field">
                <label class="field-label">Ghi chú khác</label>
                <textarea class="textarea" rows="2" placeholder="Ví dụ: Mức độ ồn, chướng ngại vật."></textarea>
              </div>
            </fieldset>

            <fieldset class="block-card">
              <div class="block-head">
                <h3 class="block-title">Nguồn lực sẵn có</h3>
              </div>
              <p class="form-note">Tạo một hoặc nhiều nhóm nguồn lực phù hợp với case.</p>
              <div class="block-list" data-resource-list>
                <div class="block-card" data-resource-block>
                  <div class="block-head">
                    <h4 class="block-title">Nhóm nguồn lực</h4>
                    <button type="button" data-remove-resource class="link-action">Xóa</button>
                  </div>
                  <div class="field-grid" data-cols="2">
                    <div class="field">
                      <label class="field-label">Tên nhóm</label>
                      <input type="text" class="input" placeholder="ví dụ: Thiết bị hỗ trợ" />
                    </div>
                    <div class="field">
                      <label class="field-label">Ghi chú</label>
                      <input type="text" class="input" placeholder="ví dụ: Đặt tại kho phụ" />
                    </div>
                  </div>
                  <div class="field">
                    <label class="field-label">Danh sách nguồn lực</label>
                    <textarea class="textarea" rows="3" placeholder="Ghi từng nguồn lực trên một dòng."></textarea>
                  </div>
                </div>
              </div>
              <div class="form-actions">
                <button type="button" data-add-resource class="btn btn--ghost">+ Thêm nhóm</button>
              </div>
            </fieldset>

            <fieldset class="block-card">
              <div class="block-head">
                <h3 class="block-title">Ràng buộc &amp; chính sách</h3>
              </div>
              <div class="field-grid" data-cols="2">
                <div class="field">
                  <label class="field-label">Ràng buộc hiện trường</label>
                  <textarea class="textarea" rows="3" placeholder="Không gian hạn chế, thiếu thiết bị..."></textarea>
                </div>
                <div class="field">
                  <label class="field-label">Chính sách áp dụng</label>
                  <textarea class="textarea" rows="3" placeholder="Tuân thủ SOP, ưu tiên an toàn..."></textarea>
                </div>
              </div>
            </fieldset>

            <fieldset class="block-card">
              <div class="block-head">
                <h3 class="block-title">Bàn giao &amp; kết thúc</h3>
              </div>
              <div class="field">
                <label class="field-label">Đơn vị tiếp nhận</label>
                <input type="text" class="input" placeholder="ví dụ: Đội phản ứng chuyên trách" />
              </div>
              <div class="field">
                <label class="field-label">Trạng thái thành công</label>
                <textarea class="textarea" rows="3" placeholder="Ví dụ: Nạn nhân ổn định, thông tin bàn giao đầy đủ."></textarea>
              </div>
            </fieldset>

            <div class="form-actions">
              <button type="reset" class="btn btn--ghost">Reset</button>
              <button type="submit" class="btn btn--primary">Lưu Context</button>
            </div>
          </form>
        </section>

        <section id="panel-personas" role="tabpanel" aria-labelledby="tab-personas" data-panel="personas" class="tab-panel">
          <form class="form-section" data-prevent-submit>
            <div class="field-grid" data-cols="2">
              <div class="field">
                <label class="field-label">Case ID</label>
                <input type="text" class="input" placeholder="ví dụ: case_training_001" />
              </div>
              <div class="field">
                <label class="field-label">Số lượng persona (tham khảo)</label>
                <input type="number" min="1" class="input" placeholder="ví dụ: 4" />
              </div>
            </div>

            <p class="form-note">Mỗi persona đại diện cho một nhân vật tương tác trong case. Có thể thêm hoặc xóa tùy nhu cầu.</p>

            <div class="block-list" data-persona-list>
              <div class="block-card" data-persona-item>
                <div class="block-head">
                  <h3 class="block-title">Persona</h3>
                  <button type="button" data-remove-persona class="link-action">Xóa</button>
                </div>
                <div class="field-grid" data-cols="2">
                  <div class="field">
                    <label class="field-label">Persona ID</label>
                    <input type="text" class="input" placeholder="ví dụ: P1" />
                  </div>
                  <div class="field">
                    <label class="field-label">Tên nhân vật</label>
                    <input type="text" class="input" placeholder="ví dụ: Điều phối viên" />
                  </div>
                  <div class="field">
                    <label class="field-label">Vai trò</label>
                    <input type="text" class="input" placeholder="ví dụ: Hỗ trợ hiện trường" />
                  </div>
                  <div class="field">
                    <label class="field-label">Tuổi</label>
                    <input type="number" min="0" class="input" placeholder="ví dụ: 35" />
                  </div>
                  <div class="field">
                    <label class="field-label">Giới tính</label>
                    <input type="text" class="input" placeholder="ví dụ: Nam/Nữ/Khác" />
                  </div>
                </div>
                <div class="field">
                  <label class="field-label">Lý lịch / hoàn cảnh</label>
                  <textarea class="textarea" rows="3" placeholder="Kinh nghiệm, bối cảnh làm việc..."></textarea>
                </div>
                <div class="field">
                  <label class="field-label">Tính cách</label>
                  <textarea class="textarea" rows="3" placeholder="Ví dụ: Tập trung, quyết đoán."></textarea>
                </div>
                <div class="field-grid" data-cols="2">
                  <div class="field">
                    <label class="field-label">Mục tiêu</label>
                    <textarea class="textarea" rows="3" placeholder="Ví dụ: Hỗ trợ nhóm chính."></textarea>
                  </div>
                  <div class="field">
                    <label class="field-label">Speech pattern</label>
                    <textarea class="textarea" rows="3" placeholder="Ví dụ: Ngắn gọn, nhiều câu hỏi xác nhận."></textarea>
                  </div>
                </div>
                <div class="field-grid" data-cols="3">
                  <div class="field">
                    <label class="field-label">Emotion bắt đầu</label>
                    <input type="text" class="input" placeholder="ví dụ: Lo lắng" />
                  </div>
                  <div class="field">
                    <label class="field-label">Emotion kết thúc</label>
                    <input type="text" class="input" placeholder="ví dụ: An tâm" />
                  </div>
                  <div class="field">
                    <label class="field-label">Voice tags</label>
                    <input type="text" class="input" placeholder="ví dụ: mentor, calm" />
                  </div>
                </div>
                <div class="field">
                  <label class="field-label">Cảm xúc trong quá trình</label>
                  <textarea class="textarea" rows="3" placeholder="Ví dụ: căng thẳng, tập trung, nhẹ nhõm."></textarea>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button type="button" data-add-persona class="btn btn--ghost">+ Thêm persona</button>
            </div>

            <div class="form-actions">
              <button type="reset" class="btn btn--ghost">Reset</button>
              <button type="submit" class="btn btn--primary">Lưu Personas</button>
            </div>
          </form>
        </section>
      </div>
    </main>
  </div>

  <template id="resource-template">
    <div class="block-card" data-resource-block>
      <div class="block-head">
        <h4 class="block-title">Nhóm nguồn lực</h4>
        <button type="button" data-remove-resource class="link-action">Xóa</button>
      </div>
      <div class="field-grid" data-cols="2">
        <div class="field">
          <label class="field-label">Tên nhóm</label>
          <input type="text" class="input" placeholder="ví dụ: Nhân lực hỗ trợ" />
        </div>
        <div class="field">
          <label class="field-label">Ghi chú</label>
          <input type="text" class="input" placeholder="ví dụ: Liên hệ trưởng ca" />
        </div>
      </div>
      <div class="field">
        <label class="field-label">Danh sách nguồn lực</label>
        <textarea class="textarea" rows="3" placeholder="Ghi từng nguồn lực trên một dòng."></textarea>
      </div>
    </div>
  </template>

  <template id="skeleton-event-template">
    <div class="block-card" data-event-block>
      <div class="block-head">
        <h3 class="block-title">Canon Event</h3>
        <button type="button" data-remove-event class="link-action">Xóa</button>
      </div>
      <div class="field-grid" data-cols="2">
        <div class="field">
          <label class="field-label">Mã sự kiện</label>
          <input type="text" class="input" placeholder="ví dụ: CE2" />
        </div>
        <div class="field">
          <label class="field-label">Tiêu đề</label>
          <input type="text" class="input" placeholder="ví dụ: Điều phối phản ứng" />
        </div>
      </div>
      <div class="field">
        <label class="field-label">Mô tả chi tiết</label>
        <textarea class="textarea" rows="3" placeholder="Mô tả nhiệm vụ của event."></textarea>
      </div>
      <div class="field-grid" data-cols="2">
        <div class="field">
          <label class="field-label">Success criteria</label>
          <textarea class="textarea" rows="3" placeholder="Ghi từng tiêu chí trên một dòng."></textarea>
        </div>
        <div class="field">
          <label class="field-label">NPC tham gia</label>
          <input type="text" class="input" placeholder="ví dụ: P2, P3" />
        </div>
      </div>
      <div class="field-grid" data-cols="3">
        <div class="field">
          <label class="field-label">Timeout</label>
          <input type="number" min="0" class="input" placeholder="ví dụ: 3" />
        </div>
        <div class="field">
          <label class="field-label">On Success</label>
          <input type="text" class="input" placeholder="ví dụ: CE3" />
        </div>
        <div class="field">
          <label class="field-label">On Fail</label>
          <input type="text" class="input" placeholder="ví dụ: CE2_RETRY" />
        </div>
      </div>
    </div>
  </template>

  <template id="persona-template">
    <div class="block-card" data-persona-item>
      <div class="block-head">
        <h3 class="block-title">Persona</h3>
        <button type="button" data-remove-persona class="link-action">Xóa</button>
      </div>
      <div class="field-grid" data-cols="2">
        <div class="field">
          <label class="field-label">Persona ID</label>
          <input type="text" class="input" placeholder="ví dụ: P2" />
        </div>
        <div class="field">
          <label class="field-label">Tên nhân vật</label>
          <input type="text" class="input" placeholder="ví dụ: Điều phối viên phụ" />
        </div>
        <div class="field">
          <label class="field-label">Vai trò</label>
          <input type="text" class="input" placeholder="ví dụ: Hỗ trợ hậu cần" />
        </div>
        <div class="field">
          <label class="field-label">Tuổi</label>
          <input type="number" min="0" class="input" placeholder="ví dụ: 32" />
        </div>
        <div class="field">
          <label class="field-label">Giới tính</label>
          <input type="text" class="input" placeholder="ví dụ: Nam/Nữ/Khác" />
        </div>
      </div>
      <div class="field">
        <label class="field-label">Lý lịch / hoàn cảnh</label>
        <textarea class="textarea" rows="3" placeholder="Kinh nghiệm, điểm mạnh, hạn chế..."></textarea>
      </div>
      <div class="field">
        <label class="field-label">Tính cách</label>
        <textarea class="textarea" rows="3" placeholder="Ví dụ: Bình tĩnh, nhanh nhẹn."></textarea>
      </div>
      <div class="field-grid" data-cols="2">
        <div class="field">
          <label class="field-label">Mục tiêu</label>
          <textarea class="textarea" rows="3" placeholder="Ví dụ: Hỗ trợ đội chính."></textarea>
        </div>
        <div class="field">
          <label class="field-label">Speech pattern</label>
          <textarea class="textarea" rows="3" placeholder="Ví dụ: Ngắn gọn, trực tiếp."></textarea>
        </div>
      </div>
      <div class="field-grid" data-cols="3">
        <div class="field">
          <label class="field-label">Emotion bắt đầu</label>
          <input type="text" class="input" placeholder="ví dụ: Lo lắng" />
        </div>
        <div class="field">
          <label class="field-label">Emotion kết thúc</label>
          <input type="text" class="input" placeholder="ví dụ: Bình tĩnh" />
        </div>
        <div class="field">
          <label class="field-label">Voice tags</label>
          <input type="text" class="input" placeholder="ví dụ: mentor, calm" />
        </div>
      </div>
      <div class="field">
        <label class="field-label">Cảm xúc trong quá trình</label>
        <textarea class="textarea" rows="3" placeholder="Ví dụ: căng thẳng, tập trung, nhẹ nhõm."></textarea>
      </div>
    </div>
  </template>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const tabButtons = document.querySelectorAll("[data-tab]");
      const panels = document.querySelectorAll("[data-panel]");

      const activateTab = (tabId) => {
        tabButtons.forEach((button) => {
          const isActive = button.dataset.tab === tabId;
          button.classList.toggle("is-active", isActive);
          button.setAttribute("aria-selected", isActive ? "true" : "false");
          button.setAttribute("tabindex", isActive ? "0" : "-1");
        });

        panels.forEach((panel) => {
          panel.classList.toggle("is-active", panel.dataset.panel === tabId);
        });
      };

      tabButtons.forEach((button) => {
        button.addEventListener("click", () => activateTab(button.dataset.tab));
      });

      activateTab("skeleton");

      document.querySelectorAll("form[data-prevent-submit]").forEach((form) => {
        form.addEventListener("submit", (event) => event.preventDefault());
      });

      const resourceList = document.querySelector("[data-resource-list]");
      const resourceTemplate = document.getElementById("resource-template");

      const initResourceBlock = (block) => {
        const removeBtn = block.querySelector("[data-remove-resource]");
        if (!removeBtn) return;
        removeBtn.addEventListener("click", () => {
          if (!resourceList) return;
          if (resourceList.children.length === 1) {
            block.querySelectorAll("input, textarea").forEach((field) => (field.value = ""));
            return;
          }
          block.remove();
        });
      };

      resourceList?.querySelectorAll("[data-resource-block]").forEach(initResourceBlock);

      const addResourceBtn = document.querySelector("[data-add-resource]");
      addResourceBtn?.addEventListener("click", () => {
        if (!resourceTemplate || !resourceList) return;
        const clone = resourceTemplate.content.firstElementChild.cloneNode(true);
        resourceList.appendChild(clone);
        initResourceBlock(clone);
      });

      const skeletonEvents = document.querySelector("[data-skeleton-events]");
      const eventTemplate = document.getElementById("skeleton-event-template");

      const initEventBlock = (block) => {
        const removeBtn = block.querySelector("[data-remove-event]");
        if (!removeBtn) return;
        removeBtn.addEventListener("click", () => {
          if (!skeletonEvents) return;
          if (skeletonEvents.children.length === 1) {
            block.querySelectorAll("input, textarea").forEach((field) => (field.value = ""));
            return;
          }
          block.remove();
        });
      };

      skeletonEvents?.querySelectorAll("[data-event-block]").forEach(initEventBlock);

      const addEventBtn = document.querySelector("[data-add-event]");
      addEventBtn?.addEventListener("click", () => {
        if (!eventTemplate || !skeletonEvents) return;
        const clone = eventTemplate.content.firstElementChild.cloneNode(true);
        skeletonEvents.appendChild(clone);
        initEventBlock(clone);
      });

      const personaList = document.querySelector("[data-persona-list]");
      const personaTemplate = document.getElementById("persona-template");

      const initPersona = (item) => {
        const removeBtn = item.querySelector("[data-remove-persona]");
        if (!removeBtn) return;
        removeBtn.addEventListener("click", () => {
          if (!personaList) return;
          if (personaList.children.length === 1) {
            item.querySelectorAll("input, textarea").forEach((field) => (field.value = ""));
            return;
          }
          item.remove();
        });
      };

      personaList?.querySelectorAll("[data-persona-item]").forEach(initPersona);

      const addPersonaBtn = document.querySelector("[data-add-persona]");
      addPersonaBtn?.addEventListener("click", () => {
        if (!personaTemplate || !personaList) return;
        const clone = personaTemplate.content.firstElementChild.cloneNode(true);
        personaList.appendChild(clone);
        initPersona(clone);
      });
    });
  </script>
</body>
</html>
