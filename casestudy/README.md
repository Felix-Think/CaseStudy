                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚        INPUT (JSON)          â”‚
                          â”‚  case_id: drowning_pool_001  â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚                     â”‚                     â”‚
                   â–¼                     â–¼                     â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ skeleton.json   â”‚     â”‚ personas.json      â”‚  â”‚ context.json         â”‚
       â”‚ (Canon Events)  â”‚     â”‚ (Character Data)   â”‚  â”‚ (Scene, Policy, ...) â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                     â”‚                     â”‚
                   â”‚                     â”‚                     â”‚
                   â–¼                     â–¼                     â–¼
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         ğŸ§± **Táº¦NG 1 â€“ LOGIC MEMORY (Cáº¤U TRÃšC DETERMINISTIC)**
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- LÆ°u á»Ÿ dáº¡ng: JSON / GraphStore  
- Quáº£n lÃ½ cÃ¡c "Canon Events" â€“ chuá»—i logic há»c táº­p  
- Quy Ä‘á»‹nh: phase, preconditions, required_actions, on_success / on_fail  
- KhÃ´ng cÃ³ embedding â€“ chá»‰ truy xuáº¥t theo ID  
- DÃ¹ng Ä‘á»ƒ Ä‘iá»u hÆ°á»›ng flow trong LangGraph

ğŸ‘‰ **VÃ­ dá»¥:**  
`CE1_DANH_GIA_AN_TOAN â†’ CE2_KICH_HOAT_CAP_CUU`  
Náº¿u user Ä‘áº¡t tiÃªu chÃ­ thÃ¬ chuyá»ƒn node logic.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         ğŸŒ **Táº¦NG 2 â€“ SEMANTIC MEMORY (TRÃ NHá»š NGá»® NGHÄ¨A)**
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- LÆ°u á»Ÿ dáº¡ng: VectorDB (FAISS / Chroma / Milvus)  
- Gá»“m: Scene, Persona, Resource, Constraint, Policy, Success Criteria (rÃºt gá»n)  
- Má»—i tÃ i liá»‡u = 1 Document cÃ³ embedding  
- Cho phÃ©p truy váº¥n theo *ngá»¯ nghÄ©a* ("ai cÃ³ thá»ƒ giÃºp", "rá»§i ro hiá»‡n trÆ°á»ng")  

| Loáº¡i Index | Ná»™i dung | DÃ¹ng cho |
|-------------|-----------|-----------|
| `scene_index` | MÃ´ táº£ mÃ´i trÆ°á»ng, thá»i tiáº¿t, tiáº¿ng á»“n, nguá»“n lá»±c | Sinh â€œbá»‘i cáº£nhâ€ |
| `persona_index` | NhÃ¢n váº­t, vai trÃ², tÃ­nh cÃ¡ch, lá»i thoáº¡i máº«u | Sinh há»™i thoáº¡i |
| `policy_index` | Quy Ä‘á»‹nh hÃ nh Ä‘á»™ng, Ä‘áº¡o Ä‘á»©c, an toÃ n | ÄÃ¡nh giÃ¡ hÃ nh Ä‘á»™ng |
| `event_semantic_index` *(tuá»³ chá»n)* | MÃ´ táº£ hÃ nh Ä‘á»™ng/tiÃªu chÃ­ trong canon event | Trá»£ giÃºp evaluate |

â†’ **VectorDB** lÃ  â€œbá»™ nhá»› hiá»ƒu biáº¿tâ€ mÃ  LLM cÃ³ thá»ƒ há»i láº¡i khi cáº§n biáº¿t **ná»™i dung mÃ´ phá»ng**,  
chá»© khÃ´ng chá»©a logic flow.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         âš™ï¸ **Táº¦NG 3 â€“ RUNTIME STATE (Bá»˜ NHá»š Táº M / HOáº T Äá»˜NG)**
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- LÆ°u trong RAM (LangGraph `GraphState`) hoáº·c cache JSON  
- Cáº­p nháº­t theo thá»i gian thá»±c khi ngÆ°á»i há»c tÆ°Æ¡ng tÃ¡c  
- Gá»“m cáº£ dá»¯ liá»‡u â€œtáº¡mâ€ vÃ  â€œtráº¡ng thÃ¡i Ä‘á»™ngâ€:

| TrÆ°á»ng | MÃ´ táº£ | Nguá»“n |
|---------|--------|--------|
| `case_id`, `current_event`, `current_phase` | xÃ¡c Ä‘á»‹nh vá»‹ trÃ­ trong flow | Skeleton |
| `scene_summary` | tÃ³m táº¯t ngáº¯n gá»n hiá»‡n trÆ°á»ng | VectorDB + LLM |
| `active_personas` | danh sÃ¡ch nhÃ¢n váº­t Ä‘ang hoáº¡t Ä‘á»™ng + tráº¡ng thÃ¡i cáº£m xÃºc | PersonaIndex + runtime |
| `dialogue_history` | log há»™i thoáº¡i (user â†” AI) | runtime |
| `phase_summary` | káº¿t quáº£ cá»§a tá»«ng phase (Ä‘áº¡t/chÆ°a Ä‘áº¡t) | Evaluate Node |
| `user_action` | hÃ nh Ä‘á»™ng gáº§n nháº¥t cá»§a há»c viÃªn | runtime |

â†’ ÄÃ¢y lÃ  nÆ¡i **LangGraph Ä‘iá»u phá»‘i thá»±c táº¿** vÃ  **LLM reasoning** hoáº¡t Ä‘á»™ng.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         ğŸ¤– **LLM REASONER**
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Nháº­n input:  
  (1) Logic tá»« Skeleton JSON  
  (2) Context semantic tá»« VectorDB  
  (3) Tráº¡ng thÃ¡i hiá»‡n táº¡i tá»« State  
- Thá»±c hiá»‡n:  
  - Viáº¿t scene narration  
  - Sinh lá»i thoáº¡i nhÃ¢n váº­t  
  - ÄÃ¡nh giÃ¡ hÃ nh Ä‘á»™ng há»c viÃªn  
- Tráº£ output ngáº¯n gá»n (â‰¤400 token) â†’ update State

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         ğŸ” **LUá»’NG Xá»¬ LÃ Tá»”NG QUAN (PHASE LOOP)**
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1ï¸âƒ£ **Load case data**  
â€ƒâ†’ load skeleton.json (logic)  
â€ƒâ†’ load scene_index & persona_index (semantic)

2ï¸âƒ£ **Retrieve Scene & Personas**  
â€ƒâ†’ query VectorDB theo phase_id

3ï¸âƒ£ **Generate Scene Context**  
â€ƒâ†’ LLM condense tá»« retrieved docs â†’ scene_summary

4ï¸âƒ£ **User Action / Dialogue**  
â€ƒâ†’ user input â†’ LLM + state.active_personas â†’ simulate conversation

5ï¸âƒ£ **Evaluate Phase**  
â€ƒâ†’ so khá»›p user_action vá»›i required_actions trong skeleton  
â€ƒâ†’ cháº¥m Ä‘iá»ƒm báº±ng success_criteria

6ï¸âƒ£ **Transition**  
â€ƒâ†’ láº¥y `on_success` hoáº·c `on_fail` tá»« skeleton  
â€ƒâ†’ cáº­p nháº­t `current_event` vÃ  `phase`

7ï¸âƒ£ **Repeat** Ä‘áº¿n khi háº¿t canon event.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


# ğŸ§­ TÆ¯ DUY KIáº¾N TRÃšC

| Táº§ng                | Vai trÃ²                                 | LÆ°u trá»¯                | LÃ½ do                         |
| ------------------- | --------------------------------------- | ---------------------- | ----------------------------- |
| **Logic Memory**    | Quy Ä‘á»‹nh hÃ nh trÃ¬nh há»c                 | JSON / GraphStore      | Cáº§n chÃ­nh xÃ¡c, khÃ´ng mÆ¡ há»“    |
| **Semantic Memory** | Cung cáº¥p tri thá»©c cho LLM hiá»ƒu tháº¿ giá»›i | VectorDB               | Cáº§n tÃ¬m theo nghÄ©a, khÃ´ng key |
| **Runtime State**   | Giá»¯ tráº¡ng thÃ¡i mÃ´ phá»ng                 | LangGraph State / JSON | Cáº§n cáº­p nháº­t Ä‘á»™ng, táº¡m thá»i   |

# ğŸ§© Má»I QUAN Há»† 3 Táº¦NG

                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚         LOGIC MEMORY          â”‚
                 â”‚  (skeleton.json / GraphStore) â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚       SEMANTIC MEMORY         â”‚
           â”‚   (VectorDB: scene, persona)  â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚        RUNTIME STATE          â”‚
           â”‚ (LangGraph GraphState / JSON) â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                      ğŸ¤– LLM Reasoner
                  (Generate â€“ Evaluate â€“ Transition)


# âœ… TÃ³m táº¯t dá»… hiá»ƒu

| ThÃ nh pháº§n           | TÃ­nh cháº¥t             | Truy cáº­p               | Cáº­p nháº­t          | Vai trÃ²                    |
| -------------------- | --------------------- | ---------------------- | ----------------- | -------------------------- |
| **Skeleton JSON**    | TÄ©nh, cáº¥u trÃºc logic  | Key lookup (`id`)      | KhÃ´ng thay Ä‘á»•i    | Äiá»u khiá»ƒn flow            |
| **VectorDB Indexes** | Ngá»¯ nghÄ©a, dÃ i, mÃ´ táº£ | Semantic search        | Ãt thay Ä‘á»•i       | Cung cáº¥p tri thá»©c          |
| **LangGraph State**  | Äá»™ng, phiÃªn táº¡m       | Direct (Python object) | Cáº­p nháº­t liÃªn tá»¥c | Giá»¯ tiáº¿n trÃ¬nh & hÃ nh Ä‘á»™ng |
